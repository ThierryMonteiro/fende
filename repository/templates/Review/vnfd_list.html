{% extends "bases/review_base.html" %}
{% load advanced_inputs %}
{% load static %}
{% load i18n %}

{% block breadcrumb %}
{{ block.super }}
<li class="breadcrumb-item"><a href="{% url 'Repository:vnfd_list' %}">{% trans "VNFD List" %}</a></li>
{% endblock %}
{% block top_reviewer_VNFDS %}active{% endblock %}

{% block page_content %}

{% fende_widget location='start' widget_type='no-padding' id='vnfd_list' title=_("VNFDs Requests")%}
<table id="tab1" class="table table-striped table-bordered">
	<thead>			                
		<tr>
			<th>{% trans "Type" %}</th>
			<th><i class="fal fa-fw fa-user"></i>{% trans "Developer" %}</th>
			<th><i class="fal fa-fw fa-tags"></i>{% trans "VNF Name" %}</th>
			<th><i class="fal fa-fw fa-exclamation-circle "></i>{% trans "Abstract" %}</th>
			<th><i class="fal fa-fw fa-link"></i> Link</th>
			<th><i class="fal fa-fw fa-calendar"></i>{% trans "Date" %}</th>
			<th><i class="fal fa-fw fa-info"></i>{% trans "Request" %} </th>
			<th><i class="fal fa-fw fa-tasks"></i>{% trans "Actions" %}</th>
		</tr>
	</thead>
	<tbody>
		<!-- Populando a tabela com informações da tabela Requests -->
		{% for repository in review_list %}			 								
		<tr>
			<td>{% trans "Update" %}</td>
			<td>{{ repository.developer }} ({{ repository.institution }})</td>
			<td>{{ repository.VNF_name }}</td>
			<td>{{ repository.abstract }}</td>
			<td><a class="btn btn-xs w-100 btn-info" href="{{ repository.link }}" target="_blank"><i class="fal fa-fw fa-link"></i>{% trans "Access" %}</a></td>
			<td>{{ repository.create_date }}</td>
			<td>
				<div class="btn-group w-100">
					<button class="btn btn-xs btn-block btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
						{% trans "Options" %}
						<span class="caret"></span>
					</button>
					<div class="dropdown-menu dropdown-menu-right">
						<a class="dropdown-item" href="#" data-toggle="modal" data-target="#detailsModal" data-id="{{repository.details}}" onClick="setDetails();">{% trans "Comments" %}</a>
						<a class="dropdown-item" href="/repository/review/vnfd/download/{{repository.VNF_name}}-{{repository.version}}-{{repository.developer}}" target="_blank">Download VNFD</a>
					</div>
				</div>
			</td>
			<td>
				<div class="btn-group w-100">
					<button class="btn btn-xs btn-block btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
						{% trans "Options" %}
						<span class="caret"></span>
					</button>
					<div class="dropdown-menu right-0">
						<a class="dropdown-item" data-toggle="modal" data-target="#acceptModal" data-id="{{repository.request_id}}" onClick="setAccept({{repository.request_id}});" class="open-modal">{% trans "Approve" %}</a>
						<a class="dropdown-item open-modal" data-toggle="modal" data-target="#rejectModal" data-id="{{repository.request_id}}"onClick="setReject();">{% trans "Reject" %}</a>
					</div>
				</div>
			</td>
		</tr>
		{% endfor %}
	</tbody>
</table>

<div id="rejectModal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{% trans "Review Comments" %}</h5>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<form id="review" action="/repository/review/vnfd/reject/" method="post">
				<div class="modal-body">
					{% csrf_token %}
					<div class="form-group"> 
						<textarea rows="10" class="w-100" maxlength="2000" name="comments" form="review"> </textarea>
					</div>
					<input type="hidden" name="repository">
				</div>
				
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans "Close" %}</button>
					<button type="submit" class="btn btn-danger">{% trans "Reject" %}</button>
				</div>
			</form>
		</div>
	</div>
</div>
<div id="acceptModal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{% trans "Review Comments" %}</h5>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<form id="accept" action="/repository/review/vnfd/accept/" method="post">
				<div class="modal-body">
					{% csrf_token %}
					<div class="form-group"> 
						<textarea rows="10" class="w-100" maxlength="2000" name="comments" form="accept"> </textarea>
					</div>
					<input type="hidden" name="repository" form="accept">
				</div>
				
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans "Close" %}</button>
					<button type="submit" class="btn btn-success">{% trans "Approve" %}</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div id="detailsModal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">{% trans "Comments from developer" %}</h5>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<div class="modal-body">
				<textarea rows="10" class="w-100" name="details"></textarea>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans "Close" %}</button>
			</div>
		</form>
	</div>
</div>

{% fende_widget location='end'%}
{% endblock page_content %}

<!--SCRIPT TABELAS -->
{% block table %}
{% fende_widget location='table' %}
{% endblock %}
<!--SCRIPT TABELAS -->

{% block extra_footer %}
<script>
	var id = null;
	var myRepository = null;
	
	function accept(id, comments) {
		sleep(4000);
		location.reload();	    
	}
	
	
	function sleep(milliseconds) {
		var start = new Date().getTime();
		for (var i = 0; i < 1e7; i++) { 
			if ((new Date().getTime() - start) > milliseconds){
				break;
			}
		}
	}
	
	function setReject() {
		$('#rejectModal').on('show.bs.modal', function (e) {
			var myRepository = $(e.relatedTarget).attr('data-id');
			$(e.currentTarget).find('input[name="repository"]').val(myRepository);
		});
	}
	
	function setAccept() {
		$('#acceptModal').on('show.bs.modal', function (e) {
			var myRepository = $(e.relatedTarget).attr('data-id');
			$(e.currentTarget).find('input[name="repository"]').val(myRepository);
		});
		
	}
	
	function setDetails() {
		$('#detailsModal').on('show.bs.modal', function (e) {
			var devComments = $(e.relatedTarget).attr('data-id');
			$(e.currentTarget).find('textarea[name="details"]').val(devComments);
		});
		
	}
</script>
{% endblock %}