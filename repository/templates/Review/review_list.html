{% extends "bases/review_base.html" %}
{% load advanced_inputs %}
{% load static %}
{% load i18n %}
{% block breadcrumb %}
{{ block.super }}
<li class="breadcrumb-item"><a href="{% url 'Repository:review_list' %}">{% trans "Review List" %}</a></li>
{% endblock %}
{% block top_reviewer_repository %}active{% endblock %}

{% block page_content %}

{% fende_widget location='start' widget_type="no-padding" id='review_list' title=_("Repositories Requests") %}
{% get_current_language as LANGUAGE_CODE %}
<table id="tab1" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>{% trans "Type" %}</th>
            <th><i class="fal fa-fw fa-user"></i> {% trans "Developer" %}</th>
            <th><i class="fal fa-fw  fa-tags"></i> {% trans "VNF Name" %}</th>
            <th><i class="fal fa-fw fa-exclamation-circle "></i>{% trans "Abstract" %}</th>
            <th><i class="fal fa-fw fa-link"></i> Link</th>
            <th><i class="fal fa-fw fa-calendar"></i> {% trans "Date" %}</th>
            <th><i class="fal fa-fw fa-tasks"></i>{% trans "Actions" %}</th>
        </tr>
    </thead>
    <tbody>
        <!-- Populando a tabela com informações da tabela Requests -->
        {% for repository in review_list %}
        <tr>
            <td>{{ repository.tag }}</td>
            <td>{{ repository.developer }}</td>
            <td>{{ repository.VNF_name }}</td>
            <td>{{ repository.abstract }}</td>
            {% if repository.link == 'Package Constructor' %}
            <td><a class="btn btn-xs w-100 btn-info" href="{% url 'Repository:download' repository.request_id %}" target="_blank"><i
                class="fal fa-fw fa-link"></i>{% trans "Access" %}</a></td>
                {% else %}
                <td><a class="btn btn-xs w-100 btn-info" href="{{ repository.link }}" target="_blank"><i
                    class="fal fa-fw fa-link"></i>{% trans "Access" %}</a></td>
                    {% endif %}
                    <td>{{ repository.create_date }}</td>
                    <td>
                        <div class="btn-group w-100">
                            <button class="btn btn-xs btn-block btn-secondary dropdown-toggle" data-toggle="dropdown"
                            aria-expanded="true">
                            {% trans "Options" %}
                            <span class="caret"></span>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="#" data-toggle="modal"
                            data-target="#Modal{{ forloop.counter }}" data-id="123">{% trans "Details" %}</a>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#acceptModal"
                            data-id="{{ repository.request_id }}"
                            onClick="setAccept({{ repository.request_id }});"
                            class="open-modal">{% trans "Approve" %}</a>
                            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#rejectModal"
                            data-id="{{ repository.request_id }}" class="open-modal"
                            onClick="setReject();">{% trans "Reject" %}</a>
                        </div>
                    </div>
                </td>
            </tr>
            <div id="Modal{{ forloop.counter }}" class="modal fade" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">{% trans "Details" %}</h5>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <p><strong>{% trans "VNF Name:" %}</strong> {{ repository.VNF_name }} </p>
                            <p><strong>{% trans "Developer:" %}</strong> {{ repository.developer }} </p>
                            <p><strong>{% trans "Institution:" %}</strong> </p>
                            <p><strong>{% trans "New version:" %}</strong> {{ repository.version }} </p>
                            <p><strong>{% trans "Category:" %}</strong> </p>
                            <p><strong>{% trans "Abstract:" %}</strong> {{ repository.abstract }} </p>
                            <p><strong>{% trans "Description:" %}</strong> {{ repository.full_description }} </p>
                            <p><strong>{% trans "Repository:" %}</strong> {{ repository.link }} </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary"
                            data-dismiss="modal">{% trans "Close" %}</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
    {% fende_widget location='end' %}
    
    <div id="rejectModal" class="modal fade" role="dialog">
        <form id="review" action="/{{ LANGUAGE_CODE }}/repository/review/reject/" method="post">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans "Review Comments" %}</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="form-group">
                            <textarea class="w-100" rows="10" maxlength="2000" name="comments"
                            form="review"> </textarea>
                        </div>
                        <input type="hidden" name="repository">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                        data-dismiss="modal">{% trans "Close" %}</button>
                        <button type="submit" class="btn btn-danger">{% trans "Reject" %}</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    
    <div class="modal fade modal-backdrop-transparent" id="acceptModal" role="dialog">
        <form id="accept" action="/{{ LANGUAGE_CODE }}/repository/review/accept/" method="post">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{% trans "Review Comments" %}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true"><i class="fal fa-times"></i></span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="form-group">
                            <input type="hidden" name="repository" form="accept">
                            <textarea class="w-100" rows="10" maxlength="2000" name="comments"
                            form="accept"> </textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"
                        data-dismiss="modal">{% trans "Close" %}</button>
                        <button type="submit" class="btn btn-success">{% trans "Accept" %}</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    {% endblock page_content %}
    
    <!--SCRIPT TABELAS -->
    {% block table %}
    {% fende_widget location='table' %}
    {% endblock %}
    <!--SCRIPT TABELAS -->
    
    {% block extra_footer %}
    <script>
        var id = null;
        var myRepository = null;
        
        function accept(id, comments) {
            sleep(4000);
            location.reload();
            
        }
        
        function sleep(milliseconds) {
            var start = new Date().getTime();
            for (var i = 0; i < 1e7; i++) {
                if ((new Date().getTime() - start) > milliseconds) {
                    break;
                }
            }
        }
        
        function setReject() {
            $('#rejectModal').on('show.bs.modal', function (e) {
                var myRepository = $(e.relatedTarget).attr('data-id');
                $(e.currentTarget).find('input[name="repository"]').val(myRepository);
            });
        }
        
        function setAccept() {
            $('#acceptModal').on('show.bs.modal', function (e) {
                var myRepository = $(e.relatedTarget).attr('data-id');
                $(e.currentTarget).find('input[name="repository"]').val(myRepository);
            });
            
        }
    </script>
    {% endblock %}
    
